-- Create Tables
CREATE TABLE "users" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "username" VARCHAR,
  "password" VARCHAR,
  "first_name" VARCHAR,
  "middle_name" VARCHAR,
  "last_name" VARCHAR,
  "phone_number" VARCHAR,
  "latitude" DOUBLE PRECISION,
  "longitude" DOUBLE PRECISION,
  "address_line_1" VARCHAR,
  "address_line_2" VARCHAR
);

CREATE TABLE "search_histories" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" INT,
  "recipe_id" INT,
  "image_names" VARCHAR
);

CREATE TABLE "cuisine" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "type" VARCHAR
);

CREATE TABLE "menus" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "cuisine_id" INT,
  "name" VARCHAR UNIQUE,
  "rating" INT
);

CREATE TABLE "recipes" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" INT,
  "menu_id" INT,
  "title" VARCHAR,
  "description" VARCHAR,
  "image_name" VARCHAR,
  "recipe" VARCHAR,
  "created_at" TIMESTAMP DEFAULT now(),
  "updated_at" TIMESTAMP
);

CREATE TABLE "ingredients" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" VARCHAR,
  "category" VARCHAR,
  "unit_type" VARCHAR
);

CREATE TABLE "ingredients_on_recipes" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "recipe_id" INT,
  "ingredient_id" INT,
  "quantity" DOUBLE PRECISION
);

CREATE TABLE "comments" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "recipe_id" INT,
  "comment" VARCHAR
);

CREATE TABLE "favorites" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" INT,
  "recipe_id" INT
);

CREATE TABLE "notifications" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" INT,
  "message" TEXT,
  "is_read" BOOLEAN DEFAULT FALSE,
  "created_at" TIMESTAMP DEFAULT now()
);

CREATE TABLE "shops" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" VARCHAR,
  "address" VARCHAR,
  "phone_number" VARCHAR,
  "latitude" DOUBLE PRECISION,
  "longitude" DOUBLE PRECISION,
  "base_url" VARCHAR
);

CREATE TABLE "user_cart" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" INT,
  "ingredient_id" INT,
  "price" DOUBLE PRECISION,
  "quantity" DOUBLE PRECISION
);

-- Add Foreign Keys
ALTER TABLE "search_histories" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");
ALTER TABLE "search_histories" ADD FOREIGN KEY ("recipe_id") REFERENCES "recipes" ("id");
ALTER TABLE "menus" ADD FOREIGN KEY ("cuisine_id") REFERENCES "cuisine" ("id");
ALTER TABLE "recipes" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");
ALTER TABLE "recipes" ADD FOREIGN KEY ("menu_id") REFERENCES "menus" ("id");
ALTER TABLE "ingredients_on_recipes" ADD FOREIGN KEY ("recipe_id") REFERENCES "recipes" ("id");
ALTER TABLE "ingredients_on_recipes" ADD FOREIGN KEY ("ingredient_id") REFERENCES "ingredients" ("id");
ALTER TABLE "comments" ADD FOREIGN KEY ("recipe_id") REFERENCES "recipes" ("id");
ALTER TABLE "favorites" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");
ALTER TABLE "favorites" ADD FOREIGN KEY ("recipe_id") REFERENCES "recipes" ("id");
ALTER TABLE "notifications" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");
ALTER TABLE "user_cart" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");
ALTER TABLE "user_cart" ADD FOREIGN KEY ("ingredient_id") REFERENCES "ingredients" ("id");

-- Insert Mock Data
-- Insert mock data into users table
INSERT INTO "users" ("username", "password", "first_name", "middle_name", "last_name", "phone_number", "latitude", "longitude", "address_line_1", "address_line_2")
VALUES 
('john_doe', 'password123', 'John', 'M', 'Doe', '1234567890', 37.7749, -122.4194, '123 Main St', 'Apt 1'),
('jane_doe', 'password456', 'Jane', 'A', 'Doe', '0987654321', 34.0522, -118.2437, '456 Market St', 'Apt 2');

-- Insert mock data into cuisine table
INSERT INTO "cuisine" ("type") VALUES 
('Italian'), 
('Chinese'), 
('Mexican');

-- Insert mock data into menus table
INSERT INTO "menus" ("cuisine_id", "name", "rating") VALUES 
(3, 'Fried Rice', 5),
(2, 'Kanom Whan', 4),
(3, 'Tacos al Pastor', 5);

-- Insert mock data into recipes table
INSERT INTO "recipes" ("user_id", "menu_id", "title", "description", "image_name", "recipe")
VALUES 
(1, 1, 'Fried Rice', 'Classic Fried Rice.', 'friedrice.jpg', 'Step 1: Prepare the ingredients...'),
(2, 2, 'Kanom Whan', 'Sweet Thai dessert.', 'kanomwhan.jpg', 'Step 1: Prepare the ingredients...');

-- Insert mock data into ingredients table
INSERT INTO "ingredients" ("name", "category", "unit_type")
VALUES 
('Buffmeat', 'Meat', 'kg'),
('Lime', 'Vegetable', 'kg'),
('Egg', 'Meat', 'kg'),
('Tomato', 'Fruit', 'kg'),
('Sugar', 'Condiment', 'g'),
('Corn', 'Vegetable', 'kg');

-- Insert mock data into ingredients_on_recipes table
INSERT INTO "ingredients_on_recipes" ("recipe_id", "ingredient_id", "quantity")
VALUES 
(1, 1, 0.5),
(1, 2, 0.3),
(1, 3, 0.3),
(1, 4, 0.3),
(2, 5, 1.0),
(2, 6, 1.0);

-- Insert mock data into comments table
INSERT INTO "comments" ("recipe_id", "comment") 
VALUES 
(1, 'Delicious!'),
(2, 'Could use more sugar.');

-- Insert mock data into favorites table
INSERT INTO "favorites" ("user_id", "recipe_id") 
VALUES 
(1, 1),
(2, 2);

-- Insert mock data into notifications table
INSERT INTO "notifications" ("user_id", "message") 
VALUES 
(1, 'Your recipe was liked by someone!'),
(2, 'New comment on your recipe!');

-- Insert mock data into shops table
INSERT INTO "shops" ("name", "address", "phone_number", "latitude", "longitude", "base_url")
VALUES 
('Fresh Market', '789 Park Ave', '1231231234', 40.7128, -74.0060, 'https://freshmarket.com'),
('Gourmet Foods', '321 Elm St', '4324324321', 34.0522, -118.2437, 'https://gourmetfoods.com');

-- Insert mock data into user_cart table
INSERT INTO "user_cart" ("user_id", "ingredient_id", "price", "quantity")
VALUES 
(1, 1, 2.5, 1.0),
(2, 3, 5.0, 2.0);
